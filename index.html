<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport"content="width=device-width, initial-scale=1.0"><title>工资计算日历|Salary Calendar</title><link rel="stylesheet"href="styles.css"><script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script></head><body><style>:root{--primary:#667eea;--primary-dark:#5568d3;--secondary:#764ba2;--success:#10b981;--warning:#f59e0b;--danger:#ef4444;--info:#3b82f6;--bg-primary:#ffffff;--bg-secondary:#f8fafc;--bg-tertiary:#f1f5f9;--text-primary:#1e293b;--text-secondary:#64748b;--text-tertiary:#94a3b8;--border:#e2e8f0;--shadow:rgba(0,0,0,0.1);--shadow-lg:rgba(0,0,0,0.15);--gradient-1:linear-gradient(135deg,#667eea 0%,#764ba2 100%);--gradient-2:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);--gradient-3:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);--gradient-4:linear-gradient(135deg,#fa709a 0%,#fee140 100%);--radius:12px;--radius-lg:16px;--transition:all 0.3s cubic-bezier(0.4,0,0.2,1)}[data-theme="dark"]{--bg-primary:#0f172a;--bg-secondary:#1e293b;--bg-tertiary:#334155;--text-primary:#f1f5f9;--text-secondary:#cbd5e1;--text-tertiary:#94a3b8;--border:#334155;--shadow:rgba(0,0,0,0.3);--shadow-lg:rgba(0,0,0,0.5)}*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;background:var(--bg-secondary);color:var(--text-primary);line-height:1.6;transition:var(--transition)}.container{max-width:1400px;margin:0 auto;padding:20px}.header{background:var(--bg-primary);border-radius:var(--radius-lg);padding:24px;margin-bottom:24px;box-shadow:0 1px 3px var(--shadow)}.header-content{display:flex;justify-content:space-between;align-items:center}.logo{display:flex;align-items:center;gap:16px;color:var(--primary)}.logo h1{font-size:24px;font-weight:700;background:var(--gradient-1);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.btn-icon{width:44px;height:44px;border-radius:var(--radius);border:none;background:var(--bg-secondary);color:var(--text-primary);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--transition)}.btn-icon:hover{background:var(--bg-tertiary);transform:scale(1.05)}[data-theme="light"].icon-moon,[data-theme="dark"].icon-sun{display:none}.main{background:var(--bg-primary);border-radius:var(--radius-lg);padding:32px;box-shadow:0 1px 3px var(--shadow)}.month-navigation{display:flex;align-items:center;justify-content:center;gap:24px;margin-bottom:32px}.btn-nav{width:44px;height:44px;border-radius:50%;border:none;background:var(--bg-secondary);color:var(--text-primary);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--transition)}.btn-nav:hover{background:var(--primary);color:white;transform:scale(1.1)}.current-month{font-size:28px;font-weight:700;min-width:250px;text-align:center}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:32px}.stat-card{background:var(--bg-secondary);border-radius:var(--radius-lg);padding:24px;display:flex;align-items:center;gap:16px;transition:var(--transition)}.stat-card:hover{transform:translateY(-4px);box-shadow:0 8px 16px var(--shadow-lg)}.stat-card.highlight{background:var(--gradient-4);color:white}.stat-card.highlight.stat-label,.stat-card.highlight.stat-value{color:white}.stat-icon{width:56px;height:56px;border-radius:var(--radius);display:flex;align-items:center;justify-content:center;flex-shrink:0}.stat-info{flex:1}.stat-label{font-size:14px;color:var(--text-secondary);margin-bottom:4px}.stat-value{font-size:24px;font-weight:700;color:var(--text-primary)}.stat-value.total{font-size:28px}.calendar-container{margin-bottom:32px}.calendar-header{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-bottom:8px}.weekday{text-align:center;padding:12px;font-weight:600;font-size:14px;color:var(--text-secondary)}.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}.calendar-day{aspect-ratio:1;border-radius:var(--radius);padding:12px;cursor:pointer;transition:var(--transition);border:2px solid transparent;position:relative;display:flex;flex-direction:column;background:var(--bg-secondary)}.calendar-day:hover{transform:translateY(-2px);box-shadow:0 4px 12px var(--shadow-lg);border-color:var(--primary)}.calendar-day.other-month{opacity:0.3;pointer-events:none}.calendar-day.today{border-color:var(--primary);box-shadow:0 0 0 1px var(--primary)}.day-number{font-weight:600;font-size:16px;margin-bottom:4px}.day-hours{font-size:12px;color:var(--text-secondary);margin-top:auto}.day-badge{position:absolute;top:8px;right:8px;width:8px;height:8px;border-radius:50%}.calendar-day.has-work{background:linear-gradient(135deg,var(--bg-secondary)0%,rgba(102,126,234,0.1)100%)}.calendar-day.rest.day-badge{background:var(--info)}.calendar-day.holiday.day-badge{background:var(--danger)}.calendar-day.unpaid.day-badge{background:var(--warning)}.calendar-day.paid.day-badge{background:var(--success)}.action-buttons{display:flex;justify-content:center;gap:16px}.btn-primary,.btn-secondary{padding:14px 32px;border-radius:var(--radius);border:none;font-size:16px;font-weight:600;cursor:pointer;transition:var(--transition);display:flex;align-items:center;gap:8px}.btn-primary{background:var(--gradient-1);color:white}.btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 16px var(--shadow-lg)}.btn-secondary{background:var(--bg-secondary);color:var(--text-primary)}.btn-secondary:hover{background:var(--bg-tertiary)}.modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);z-index:1000;align-items:center;justify-content:center;padding:20px}.modal.active{display:flex}.modal-content{background:var(--bg-primary);border-radius:var(--radius-lg);width:100%;max-width:500px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 25px-5px rgba(0,0,0,0.3);animation:modalSlideIn 0.3s ease-out}.modal-content.export-modal{max-width:600px}@keyframes modalSlideIn{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.modal-header{display:flex;justify-content:space-between;align-items:center;padding:24px;border-bottom:1px solid var(--border)}.modal-header h3{font-size:20px;font-weight:700;background:var(--gradient-1);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.btn-close{width:36px;height:36px;border-radius:50%;border:none;background:var(--bg-secondary);color:var(--text-primary);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--transition)}.btn-close:hover{background:var(--danger);color:white;transform:rotate(90deg)}.modal-body{padding:24px}.form-group{margin-bottom:20px}.form-group label{display:block;margin-bottom:8px;font-weight:600;font-size:14px;color:var(--text-secondary)}.form-control{width:100%;padding:12px;border:2px solid var(--border);border-radius:var(--radius);background:var(--bg-secondary);color:var(--text-primary);font-size:16px;transition:var(--transition)}.form-control:focus{outline:none;border-color:var(--primary);background:var(--bg-primary)}.form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}.day-type-buttons{display:flex;flex-wrap:wrap;gap:8px}.day-type-btn{padding:10px 16px;border-radius:var(--radius);border:2px solid var(--border);background:var(--bg-secondary);color:var(--text-primary);font-size:14px;font-weight:600;cursor:pointer;transition:var(--transition)}.day-type-btn:hover{border-color:var(--primary)}.day-type-btn.active{background:var(--primary);border-color:var(--primary);color:white}.work-summary{background:var(--bg-secondary);border-radius:var(--radius);padding:16px;margin-top:16px;font-size:14px}.work-summary p{display:flex;justify-content:space-between;margin-bottom:8px}.work-summary p:last-child{margin-bottom:0;font-weight:700;font-size:16px;padding-top:8px;border-top:1px solid var(--border)}.form-actions{display:flex;gap:12px;margin-top:24px}.form-actions button{flex:1}.export-content{padding:32px}.export-header{text-align:center;margin-bottom:32px;padding-bottom:24px;border-bottom:2px solid var(--border)}.export-header h2{font-size:28px;color:var(--primary);margin-bottom:8px}.export-period{font-size:16px;color:var(--text-secondary)}.export-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-bottom:32px}.export-stat-item{display:flex;justify-content:space-between;padding:12px;background:var(--bg-secondary);border-radius:var(--radius)}.export-stat-item.label{font-size:14px;color:var(--text-secondary)}.export-stat-item.value{font-weight:700;color:var(--primary)}.export-payment{background:var(--bg-secondary);border-radius:var(--radius-lg);padding:24px;margin-bottom:32px}.payment-row{display:flex;justify-content:space-between;padding:12px 0;font-size:16px}.payment-total{display:flex;justify-content:space-between;padding:20px 0;font-size:24px;font-weight:700;border-top:2px solid var(--border);margin-top:12px;color:var(--primary)}.export-footer{text-align:center;padding-top:24px;border-top:1px solid var(--border);color:var(--text-secondary);font-size:14px}.developer{margin-top:4px;font-weight:600;color:var(--primary)}.modal-footer{padding:24px;border-top:1px solid var(--border)}.modal-footer button{width:100%}.footer{text-align:center;padding:24px;color:var(--text-secondary);font-size:14px}.footer strong{color:var(--primary);font-weight:700}@media(max-width:768px){.container{padding:12px}.header{padding:16px}.logo h1{font-size:20px}.main{padding:20px}.current-month{font-size:20px;min-width:180px}.stats-grid{grid-template-columns:1fr;gap:12px}.calendar-day{padding:8px;font-size:14px}.day-number{font-size:14px}.day-hours{font-size:10px}.form-row{grid-template-columns:1fr}.export-stats{grid-template-columns:1fr}.export-content{padding:20px}}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:var(--bg-secondary)}::-webkit-scrollbar-thumb{background:var(--text-tertiary);border-radius:4px}::-webkit-scrollbar-thumb:hover{background:var(--text-secondary)}</style><div class="container"><!--头部--><header class="header"><div class="header-content"><div class="logo"><svg width="32"height="32"viewBox="0 0 32 32"fill="none"><rect width="32"height="32"rx="8"fill="currentColor"opacity="0.1"/><path d="M8 12h16M8 16h16M8 20h10"stroke="currentColor"stroke-width="2"stroke-linecap="round"/></svg><h1>Salary Calendar</h1></div><div class="header-actions"><button class="btn-icon"id="themeToggle"title="切换主题"><svg class="icon-sun"width="20"height="20"viewBox="0 0 24 24"fill="none"stroke="currentColor"stroke-width="2"><circle cx="12"cy="12"r="5"/><line x1="12"y1="1"x2="12"y2="3"/><line x1="12"y1="21"x2="12"y2="23"/><line x1="4.22"y1="4.22"x2="5.64"y2="5.64"/><line x1="18.36"y1="18.36"x2="19.78"y2="19.78"/><line x1="1"y1="12"x2="3"y2="12"/><line x1="21"y1="12"x2="23"y2="12"/><line x1="4.22"y1="19.78"x2="5.64"y2="18.36"/><line x1="18.36"y1="5.64"x2="19.78"y2="4.22"/></svg><svg class="icon-moon"width="20"height="20"viewBox="0 0 24 24"fill="none"stroke="currentColor"stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></button></div></div></header><!--主要内容--><main class="main"><!--月份导航--><div class="month-navigation"><button class="btn-nav"id="prevMonth"><svg width="20"height="20"viewBox="0 0 24 24"fill="none"stroke="currentColor"stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg></button><h2 class="current-month"id="currentMonth"></h2><button class="btn-nav"id="nextMonth"><svg width="20"height="20"viewBox="0 0 24 24"fill="none"stroke="currentColor"stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></button></div><!--月度统计卡片--><div class="stats-grid"><div class="stat-card"><div class="stat-icon"style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"><svg width="24"height="24"viewBox="0 0 24 24"fill="none"stroke="white"stroke-width="2"><circle cx="12"cy="12"r="10"/><polyline points="12 6 12 12 16 14"/></svg></div><div class="stat-info"><p class="stat-label">总工作时长</p><p class="stat-value"id="totalHours">0</p></div></div><div class="stat-card"><div class="stat-icon"style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"><svg width="24"height="24"viewBox="0 0 24 24"fill="none"stroke="white"stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div><div class="stat-info"><p class="stat-label">基本工资</p><p class="stat-value"id="regularPay">RM 0</p></div></div><div class="stat-card"><div class="stat-icon"style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"><svg width="24"height="24"viewBox="0 0 24 24"fill="none"stroke="white"stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg></div><div class="stat-info"><p class="stat-label">加班工资(OT)</p><p class="stat-value"id="otPay">RM 0</p></div></div><div class="stat-card highlight"><div class="stat-icon"style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"><svg width="24"height="24"viewBox="0 0 24 24"fill="none"stroke="white"stroke-width="2"><line x1="12"y1="1"x2="12"y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div><div class="stat-info"><p class="stat-label">总工资</p><p class="stat-value total"id="totalPay">RM 0</p></div></div></div><!--日历--><div class="calendar-container"><div class="calendar-header"><div class="weekday">日</div><div class="weekday">一</div><div class="weekday">二</div><div class="weekday">三</div><div class="weekday">四</div><div class="weekday">五</div><div class="weekday">六</div></div><div class="calendar-grid"id="calendarGrid"></div></div><!--结算按钮--><div class="action-buttons"><button class="btn-primary"id="exportBtn"><svg width="20"height="20"viewBox="0 0 24 24"fill="none"stroke="currentColor"stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12"y1="15"x2="12"y2="3"/></svg>导出结算单</button></div></main><!--日期详情模态框--><div class="modal"id="dayModal"><div class="modal-content"><div class="modal-header"><h3 id="modalTitle">编辑工作记录</h3><button class="btn-close"id="closeModal"><svg width="24"height="24"viewBox="0 0 24 24"fill="none"stroke="currentColor"stroke-width="2"><line x1="18"y1="6"x2="6"y2="18"/><line x1="6"y1="6"x2="18"y2="18"/></svg></button></div><div class="modal-body"><div class="form-group"><label>日期类型</label><div class="day-type-buttons"><button class="day-type-btn active"data-type="work">工作日</button><button class="day-type-btn"data-type="rest">休息日</button><button class="day-type-btn"data-type="holiday">公共假期</button><button class="day-type-btn"data-type="unpaid">无薪假</button><button class="day-type-btn"data-type="paid">带薪假</button></div></div><div id="workTimeSection"><div class="form-row"><div class="form-group"><label>上班时间</label><input type="time"id="startTime"class="form-control"></div><div class="form-group"><label>下班时间</label><input type="time"id="endTime"class="form-control"></div></div><div class="form-group"><label>休息时长（分钟）</label><input type="number"id="breakTime"class="form-control"value="0"min="0"></div><div class="work-summary"id="workSummary"></div></div><div class="form-actions"><button class="btn-secondary"id="deleteDay">删除记录</button><button class="btn-primary"id="saveDay">保存</button></div></div></div></div><!--导出预览模态框--><div class="modal"id="exportModal"><div class="modal-content export-modal"><div class="modal-header"><h3>工资结算单</h3><button class="btn-close"id="closeExportModal"><svg width="24"height="24"viewBox="0 0 24 24"fill="none"stroke="currentColor"stroke-width="2"><line x1="18"y1="6"x2="6"y2="18"/><line x1="6"y1="6"x2="18"y2="18"/></svg></button></div><div class="export-content"id="exportContent"><div class="export-header"><h2>工资结算单</h2><p class="export-period"id="exportPeriod"></p></div><div class="export-stats"><div class="export-stat-item"><span class="label">总工作时长</span><span class="value"id="exportTotalHours"></span></div><div class="export-stat-item"><span class="label">基本时长(0-180h)</span><span class="value"id="exportRegularHours"></span></div><div class="export-stat-item"><span class="label">加班时长(>180h)</span><span class="value"id="exportOtHours"></span></div><div class="export-stat-item"><span class="label">工作天数</span><span class="value"id="exportWorkDays"></span></div><div class="export-stat-item"><span class="label">休息日</span><span class="value"id="exportRestDays"></span></div><div class="export-stat-item"><span class="label">公共假期</span><span class="value"id="exportHolidays"></span></div><div class="export-stat-item"><span class="label">带薪假</span><span class="value"id="exportPaidLeave"></span></div><div class="export-stat-item"><span class="label">无薪假</span><span class="value"id="exportUnpaidLeave"></span></div></div><div class="export-payment"><div class="payment-row"><span>基本工资(RM8/小时)</span><span id="exportRegularPay"></span></div><div class="payment-row"><span>加班工资(RM12/小时)</span><span id="exportOtPay"></span></div><div class="payment-total"><span>总工资</span><span id="exportTotalPay"></span></div></div><div class="export-footer"><p>Generated by Salary Calendar</p><p class="developer">Developed by Henry</p></div></div><div class="modal-footer"><button class="btn-primary"id="downloadImage"><svg width="20"height="20"viewBox="0 0 24 24"fill="none"stroke="currentColor"stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12"y1="15"x2="12"y2="3"/></svg>下载图片</button></div></div></div><!--页脚--><footer class="footer"><p>Developed with❤️by<strong>Henry</strong></p></footer></div><script src="script.js"></script><script>const state={currentDate:new Date(),workRecords:{},theme:'light'};const HOURLY_RATE=8;const OT_RATE=12;const OT_THRESHOLD=180;document.addEventListener('DOMContentLoaded',()=>{loadFromStorage();initTheme();initEventListeners();renderCalendar();updateStats()});function initTheme(){const savedTheme=localStorage.getItem('theme')||'light';state.theme=savedTheme;document.documentElement.setAttribute('data-theme',savedTheme)}function toggleTheme(){state.theme=state.theme==='light'?'dark':'light';document.documentElement.setAttribute('data-theme',state.theme);localStorage.setItem('theme',state.theme)}function initEventListeners(){document.getElementById('themeToggle').addEventListener('click',toggleTheme);document.getElementById('prevMonth').addEventListener('click',()=>changeMonth(-1));document.getElementById('nextMonth').addEventListener('click',()=>changeMonth(1));document.getElementById('closeModal').addEventListener('click',closeModal);document.getElementById('closeExportModal').addEventListener('click',closeExportModal);document.getElementById('saveDay').addEventListener('click',saveDay);document.getElementById('deleteDay').addEventListener('click',deleteDay);document.getElementById('exportBtn').addEventListener('click',showExportModal);document.getElementById('downloadImage').addEventListener('click',downloadImage);document.querySelectorAll('.day-type-btn').forEach(btn=>{btn.addEventListener('click',(e)=>selectDayType(e.target))});document.getElementById('startTime').addEventListener('change',updateWorkSummary);document.getElementById('endTime').addEventListener('change',updateWorkSummary);document.getElementById('breakTime').addEventListener('input',updateWorkSummary);document.getElementById('dayModal').addEventListener('click',(e)=>{if(e.target.id==='dayModal')closeModal()});document.getElementById('exportModal').addEventListener('click',(e)=>{if(e.target.id==='exportModal')closeExportModal()})}function renderCalendar(){const year=state.currentDate.getFullYear();const month=state.currentDate.getMonth();const monthNames=['一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月'];document.getElementById('currentMonth').textContent=`${year}年${monthNames[month]}`;const firstDay=new Date(year,month,1);const lastDay=new Date(year,month+1,0);const prevLastDay=new Date(year,month,0);const firstDayOfWeek=firstDay.getDay();const daysInMonth=lastDay.getDate();const daysInPrevMonth=prevLastDay.getDate();const calendarGrid=document.getElementById('calendarGrid');calendarGrid.innerHTML='';for(let i=firstDayOfWeek-1;i>=0;i--){const day=daysInPrevMonth-i;const dayElement=createDayElement(day,year,month-1,true);calendarGrid.appendChild(dayElement)}const today=new Date();for(let day=1;day<=daysInMonth;day++){const isToday=today.getDate()===day&&today.getMonth()===month&&today.getFullYear()===year;const dayElement=createDayElement(day,year,month,false,isToday);calendarGrid.appendChild(dayElement)}const remainingDays=42-calendarGrid.children.length;for(let day=1;day<=remainingDays;day++){const dayElement=createDayElement(day,year,month+1,true);calendarGrid.appendChild(dayElement)}}function createDayElement(day,year,month,isOtherMonth,isToday=false){const div=document.createElement('div');div.className='calendar-day';if(isOtherMonth){div.classList.add('other-month')}if(isToday){div.classList.add('today')}const dateKey=`${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;const record=state.workRecords[dateKey];if(record){if(record.type==='work'&&record.hours>0){div.classList.add('has-work')}else if(record.type!=='work'){div.classList.add(record.type)}}div.innerHTML=`<div class="day-number">${day}</div>${record&&record.type!=='work'?'<div class="day-badge"></div>':''}${record&&record.type==='work'&&record.hours?`<div class="day-hours">${record.hours.toFixed(1)}h</div>`:''}`;if(!isOtherMonth){div.addEventListener('click',()=>openDayModal(dateKey))}return div}function openDayModal(dateKey){state.selectedDate=dateKey;const record=state.workRecords[dateKey]||{type:'work'};document.getElementById('modalTitle').textContent=`编辑工作记录-${dateKey}`;document.querySelectorAll('.day-type-btn').forEach(btn=>{btn.classList.toggle('active',btn.dataset.type===record.type)});if(record.type==='work'){document.getElementById('startTime').value=record.startTime||'';document.getElementById('endTime').value=record.endTime||'';document.getElementById('breakTime').value=record.breakTime||0;document.getElementById('workTimeSection').style.display='block';updateWorkSummary()}else{document.getElementById('workTimeSection').style.display='none'}document.getElementById('dayModal').classList.add('active')}function closeModal(){document.getElementById('dayModal').classList.remove('active')}function closeExportModal(){document.getElementById('exportModal').classList.remove('active')}function selectDayType(btn){document.querySelectorAll('.day-type-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');const type=btn.dataset.type;document.getElementById('workTimeSection').style.display=type==='work'?'block':'none'}function updateWorkSummary(){const startTime=document.getElementById('startTime').value;const endTime=document.getElementById('endTime').value;const breakTime=parseInt(document.getElementById('breakTime').value)||0;if(!startTime||!endTime){document.getElementById('workSummary').innerHTML='';return}const start=new Date(`2000-01-01 ${startTime}`);const end=new Date(`2000-01-01 ${endTime}`);let totalMinutes=(end-start)/1000/60;if(totalMinutes<0)totalMinutes+=24*60;const workMinutes=totalMinutes-breakTime;const workHours=workMinutes/60;const hours=Math.floor(workMinutes/60);const minutes=Math.floor(workMinutes%60);document.getElementById('workSummary').innerHTML=`<p><span>总时长：</span><span>${Math.floor(totalMinutes/60)}小时${Math.floor(totalMinutes%60)}分钟</span></p><p><span>休息时长：</span><span>${breakTime}分钟</span></p><p><span>工作时长：</span><span>${hours}小时${minutes}分钟(${workHours.toFixed(2)}h)</span></p>`}function saveDay(){const dateKey=state.selectedDate;const type=document.querySelector('.day-type-btn.active').dataset.type;const record={type};if(type==='work'){const startTime=document.getElementById('startTime').value;const endTime=document.getElementById('endTime').value;const breakTime=parseInt(document.getElementById('breakTime').value)||0;if(startTime&&endTime){const start=new Date(`2000-01-01 ${startTime}`);const end=new Date(`2000-01-01 ${endTime}`);let totalMinutes=(end-start)/1000/60;if(totalMinutes<0)totalMinutes+=24*60;const workMinutes=totalMinutes-breakTime;const workHours=workMinutes/60;record.startTime=startTime;record.endTime=endTime;record.breakTime=breakTime;record.hours=workHours}}state.workRecords[dateKey]=record;saveToStorage();closeModal();renderCalendar();updateStats()}function deleteDay(){const dateKey=state.selectedDate;delete state.workRecords[dateKey];saveToStorage();closeModal();renderCalendar();updateStats()}function changeMonth(delta){state.currentDate.setMonth(state.currentDate.getMonth()+delta);renderCalendar();updateStats()}function updateStats(){const year=state.currentDate.getFullYear();const month=state.currentDate.getMonth();let totalHours=0;let workDays=0;let restDays=0;let holidays=0;let unpaidLeave=0;let paidLeave=0;Object.entries(state.workRecords).forEach(([dateKey,record])=>{const[y,m]=dateKey.split('-').map(Number);if(y===year&&m===month+1){if(record.type==='work'&&record.hours){totalHours+=record.hours;workDays++}else if(record.type==='rest'){restDays++}else if(record.type==='holiday'){holidays++}else if(record.type==='unpaid'){unpaidLeave++}else if(record.type==='paid'){paidLeave++}}});const regularHours=Math.min(totalHours,OT_THRESHOLD);const otHours=Math.max(0,totalHours-OT_THRESHOLD);const regularPay=regularHours*HOURLY_RATE;const otPay=otHours*OT_RATE;const totalPay=regularPay+otPay;document.getElementById('totalHours').textContent=`${totalHours.toFixed(1)}小时`;document.getElementById('regularPay').textContent=`RM ${regularPay.toFixed(2)}`;document.getElementById('otPay').textContent=`RM ${otPay.toFixed(2)}`;document.getElementById('totalPay').textContent=`RM ${totalPay.toFixed(2)}`;state.currentStats={totalHours,regularHours,otHours,regularPay,otPay,totalPay,workDays,restDays,holidays,unpaidLeave,paidLeave}}function showExportModal(){const year=state.currentDate.getFullYear();const month=state.currentDate.getMonth();const monthNames=['一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月'];const stats=state.currentStats;document.getElementById('exportPeriod').textContent=`${year}年${monthNames[month]}`;document.getElementById('exportTotalHours').textContent=`${stats.totalHours.toFixed(1)}小时`;document.getElementById('exportRegularHours').textContent=`${stats.regularHours.toFixed(1)}小时`;document.getElementById('exportOtHours').textContent=`${stats.otHours.toFixed(1)}小时`;document.getElementById('exportWorkDays').textContent=`${stats.workDays}天`;document.getElementById('exportRestDays').textContent=`${stats.restDays}天`;document.getElementById('exportHolidays').textContent=`${stats.holidays}天`;document.getElementById('exportPaidLeave').textContent=`${stats.paidLeave}天`;document.getElementById('exportUnpaidLeave').textContent=`${stats.unpaidLeave}天`;document.getElementById('exportRegularPay').textContent=`RM ${stats.regularPay.toFixed(2)}`;document.getElementById('exportOtPay').textContent=`RM ${stats.otPay.toFixed(2)}`;document.getElementById('exportTotalPay').textContent=`RM ${stats.totalPay.toFixed(2)}`;document.getElementById('exportModal').classList.add('active')}async function downloadImage(){const exportContent=document.getElementById('exportContent');try{const canvas=await html2canvas(exportContent,{backgroundColor:state.theme==='dark'?'#1e293b':'#ffffff',scale:2,logging:false,useCORS:true});const link=document.createElement('a');const year=state.currentDate.getFullYear();const month=state.currentDate.getMonth()+1;link.download=`工资结算单_${year}_${String(month).padStart(2,'0')}.png`;link.href=canvas.toDataURL('image/png');link.click()}catch(error){console.error('导出失败:',error);alert('导出图片失败，请重试')}}function saveToStorage(){localStorage.setItem('workRecords',JSON.stringify(state.workRecords))}function loadFromStorage(){const saved=localStorage.getItem('workRecords');if(saved){try{state.workRecords=JSON.parse(saved)}catch(error){console.error('加载数据失败:',error);state.workRecords={}}}}</script></body></html>
